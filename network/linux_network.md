Linux路由:
================


路由是选择一条数据包传输路径的过程，也就是说主机怎么向目的地发送数据的过程。当TCP/IP主机发送IP数据包时，便出现了路由，且当到达IP路由器时还会再次出现。路由器是从一个物理网向另一个物理网发送数据包的装置，路由器通常被称为网关，它承但着分发数据包的任务。对于发送的主机和路由器而言，必须决定向哪里转发数据包。在决定路由时，IP层查询位于内存中的路由表，然后根据查询规则，进行ip路由。是不是很抽象？先说如何选路：

* (1)当一个主机试图与另一个主机通信时，IP首先决定目的主机是一个内网还是外网，怎么确定？当然使用网络号。
* (2)如果是是同一内网，那就就是直接发送了，这个最简答不过了。
* (3)如果目的主机是和发送主机不在同一个内网，也就是在外网了，^_^很啰嗦，IP将查询路由表来为外网主机或外网选择一个路由，所以一般情况下有可能为某个外网指定特定的路由，具体问题稍后分析。
* (4)若未找到明确的路由，此时在路由表中还会有默认网关，也可称为缺省网关，IP用缺省的网关地址将一个数据传送给下一个指定的路由器，所以网关也可能是路由器，也可能只是内网向特定路由器传输数据的网关。
* (4)在该路由器收到数据后，它再次为远程主机或网络查询路由，若还未找到路由，该数据包将发送到该路由器的缺省网关地址。

每发现一条路由，数据包被转送下一级路由器，称为一次“跳步”，按照同样的方式进行转发，并最终发送至目的主机。若未发现任何一个路由可以接受此次ip包的地址，发送主机将收到一个出错信息，也就是说其中任何一跳出现了不可到达，最后的结果也就是报错了。

上面只是个人的一些理解，事实上当时我们做的实验不少，但是看看tcp/ip详解后，就可以一目了然了，现在以linux下的路由表为例说明一下：

    $ sudo route

    Kernel IP routing table

    Destination Gateway Genmask Flags Metric Ref Use Iface

    192.168.100.0 * 255.255.255.0 U 0 0 0 eth1

    192.168.10.0 * 255.255.254.0 U 0 0 0 eth0

    default 192.168.10.1 0.0.0.0 UG 0 0 0 eth0

    --------------------------------------------------------------------------------------

IP路由选择是逐跳地（hop-by-hop）进行的。从这个路由表信息可以看出，IP并不知道到达任何目的的完整路径（当然，除了那些与主机直接相连的目的）。所有的IP路由选择只为数据报传输提供下一站路由器的IP地址。它假定下一站路由器比发送数据报的主机更接近目的，而且下一站路由器与该主机是直接相连的。

IP路由选择主要完成以下这些功能：
----------------------------

* 搜索路由表，寻找能与目的IP地址完全匹配的表目（网络号和主机号都要匹配）。如果找到，则把报文发送给该表目指定的下一站路由器或直接连接的网络接口（取决于标志字段的值）。
* 搜索路由表，寻找能与目的网络号相匹配的表目。如果找到，则把报文发送给该表目指定的下一站路由器或直接连接的网络接口（取决于标志字段的值）。目的网络上的所有主机都可以通过这个表目来处置。例如，一个以太网上的所有主机都是通过这种表目进行寻径的。这种搜索网络的匹配方法必须考虑可能的子网掩码。关于这一点我们在下一节中进行讨论。
* 搜索路由表，寻找标为“默认（default）”的表目。如果找到，则把报文发送给该表目指定的下一站路由器。如果上面这些步骤都没有成功，那么该数据报就不能被传送。如果不能传送的数据报来自本机，那么一般会向生成数据报的应用程序返回一个“主机不可达”或 “网络不可达”的错误。



0.0.0.0
255.255.255.255

A类:1.0.0.0-126.255.255.255       最大主机数:2^24-2    私有IP范围:10.0.0.0--10.255.255.255
B类:128.0.0.0-191.255.255.255              2^16-2              172.16.0.0--172.31.255.255
C类:192.0.0.0-223.255.255.255              2^8-2               192.168.0.0--192.168.255.255

相同的网段之间只需要通过交换机就可以通信
不同的网段之间通信,需要使用路由器
